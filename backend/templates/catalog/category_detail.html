{% extends "core/base.html" %}
{% load static %}

{% block content %}

<div class="bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-6">

    {% if category.banner and category.banner.name %}
      <!-- Full-width Banner -->
      <div
        style="
          width:100vw;
          margin-left:calc(-50vw + 50%);
          margin-right:calc(-50vw + 50%);
          margin-bottom:32px;
        "
      >
        <img
          src="{{ category.banner.url }}"
          alt="{{ category.name }}"
          style="
            width:100%;
            height:360px;
            object-fit:cover;
            display:block;
          "
        >
      </div>
    {% endif %}

    {% if not category.banner %}
      <h1 class="text-2xl font-semibold mb-6">
        {{ category.name }}
      </h1>
    {% endif %}

    <!-- Category Title (shown even when banner exists) -->
    <h1 class="text-2xl font-semibold mb-6">
      {{ category.name }}
    </h1>


    {% if products %}

    <!-- PRODUCT GRID -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

      {% for product in products %}
<div class="border rounded-xl p-4 shadow-sm bg-white">

  <!-- Image -->
  <!-- <img src="{{ product.image.url }}"
       alt="{{ product.name }}"
       class="w-full h-48 object-contain mb-4"> -->
  {% if product.image %}
      <img src="{{ product.image.url }}" alt="{{ product.name }}">
  {% else %}
      <img src="{% static 'images/no-image.png' %}" alt="No image">
  {% endif %}

  <!-- Product Name -->
  <h3 class="font-semibold text-gray-800 mb-1">
    {{ product.name }}
  </h3>

  <!-- Promotion Label -->
   <!-- {% if product.active_promotion %}
      <p style="color:red;font-weight:600;">
          {% if product.active_promotion.discount_type == "PERCENTAGE" %}
              {{ product.active_promotion.discount_value|floatformat:0 }}% OFF
          {% else %}
              ₹{{ product.active_promotion.discount_value|floatformat:0 }} OFF
          {% endif %}
      </p>

      <p style="text-decoration:line-through;color:#888;">
          ₹{{ product.mrp }}
      </p>

      <p style="color:green;font-weight:700;">
          ₹{{ product.final_price }}
      </p>
  {% else %}
      <p style="color:#999;">NO PROMO</p>
      <p style="color:green;font-weight:700;">
          ₹{{ product.mrp }}
      </p>
  {% endif %} -->
  
  {# ================= DEAL PRICE (Pricing Monitor) ================= #}
  {% if product.has_deal_price %}
      <p style="color:red;font-weight:600;">
          {{product.get_promotion_label|upper}}
      </p>

      <p style="text-decoration:line-through;color:#888;">
          ₹{{ product.mrp }}
      </p>

      <p style="color:green;font-weight:700;">
          ₹{{ product.sale_price }}
      </p>

  {# ================= PROMOTION PRICE ================= #}
  {% elif product.active_promotion %}
      <p style="color:red;font-weight:600;">            
          {{ product.active_promotion|upper }}<br>      
          {% if product.active_promotion.discount_type == "PERCENTAGE" or product.active_promotion.discount_type == "percentage" %}
              DISCOUNT: {{ product.active_promotion.discount_value|floatformat:0 }}% OFF
          {% else %}
              DISCOUNT: ₹{{ product.active_promotion.discount_value|floatformat:0 }} OFF
          {% endif %}
      </p>

      <p style="text-decoration:line-through;color:#888;">
          ₹{{ product.mrp }}
      </p>

      <p style="color:green;font-weight:700;">
          ₹{{ product.final_price }}
      </p>

  {# ================= NO PROMO ================= #}
  {% else %}
      <p style="color:#999;">NO PROMO</p>              
        {% if product.sale_price %}
          <p>MRP:&nbsp;<span style="text-decoration:line-through;color:#888;"><strong> ₹{{ product.mrp }} </strong></span></p>    
          <p>Sale Price: &nbsp; <span style="color:green;font-weight:700;">₹{{ product.sale_price }}</span></p>
        {% else %}
          ₹{{ product.mrp }}
        {% endif %}
      </p>
  {% endif %}


   
  <!-- CTA -->
  <a href="{% url 'catalog:product_detail' product.slug %}"
     class="block mt-4 text-center bg-indigo-600 text-white py-2 rounded">
     View Product
  </a>

</div>
{% endfor %}

    </div>

    {% else %}
      <p>No products found in this category.</p>
    {% endif %}

  </div>
</div>

{% endblock %}
