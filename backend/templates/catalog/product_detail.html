{% extends "core/base.html" %}
{% load static %}

{% block content %}

<div class="bg-gray-50 py-6">
  <div class="max-w-7xl mx-auto px-6">

    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-500 mb-6">
      <a href="/" class="hover:text-blue-600">Home</a>
      <span class="mx-2">›</span>
      <a href="{{ product.category.get_absolute_url }}" class="hover:text-blue-600">
        {{ product.category.name }}
      </a>
      <span class="mx-2">›</span>
      <span class="text-gray-700 font-medium">{{ product.name }}</span>
    </nav>

    <!-- MAIN SECTION -->
    <div class="bg-white rounded shadow p-6">
      <div class="flex flex-col md:flex-row gap-10">

        <!-- LEFT: IMAGE -->
        <div class="md:w-1/2 p-4">
          <!-- Main Image -->
          <div class="border rounded mb-4 flex items-center justify-center h-[420px]">
            {% if product.image %}
              <img
                src="{{ product.image.url }}"
                alt="{{ product.name }}"
                class="max-h-[380px] object-contain"
              >
            {% endif %}
          </div>

          <!-- Thumbnails -->
          <div class="flex gap-3">
            {% for img in product.images.all %}
              <div class="border rounded w-20 h-20 flex items-center justify-center">
                <img src="{{ img.image.url }}" class="max-h-[70px] object-contain">
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- RIGHT: DETAILS -->
        <div class="md:w-1/2 md:pl-6 p-4">

          <h1 class="text-2xl font-semibold mb-4">
            {{ product.name }}
          </h1>

          <div class="text-sm text-gray-600 space-y-1 mb-4">
            {% if product.brand %}
              <p><strong>Brand:</strong> {{ product.brand }}</p>
            {% endif %}
            <p><strong>Product Code:</strong> {{ product.sku }}</p>
            <p>
              <strong>Availability:</strong>
              <span class="text-green-600">In Stock</span>
            </p>
          </div>

          <!-- PRICE -->
          <div class="mb-6">
            <!-- {% if product.mrp %}
              <p class="text-sm text-gray-400 line-through">
                ₹{{ product.mrp }}
              </p>
            {% endif %} -->
            <!-- <p class="text-3xl font-semibold text-gray-900">
              ₹{{ product.sale_price }}
            </p> -->

            

          <!-- <p class="text-gray-500 line-through">₹{{ product.mrp }}</p>
          <p class="text-xl font-bold text-green-600">₹{{ product.final_price }}</p> -->

         


          <!-- Promotion Label -->
           
          <!-- {% if product.active_promotion %}
              <p style="color:red;font-weight:600;">
                  {% if product.active_promotion.discount_type == "PERCENTAGE" %}
                      DISCOUNT:  {{ product.active_promotion.discount_value|floatformat:0 }}% OFF
                  {% else %}
                      DISCOUNT :  Flat - ₹{{ product.active_promotion.discount_value|floatformat:0 }} OFF
                  {% endif %}
              </p>

              <p style="text-decoration:line-through;color:#888;">
                  ₹{{ product.mrp }}
              </p>

              <p style="color:green;font-weight:700;">
                  ₹{{ product.final_price }}
              </p>
          {% else %}
              <p style="color:#999;">NO PROMO</p>
              <p style="color:green;font-weight:700;">
                  ₹{{ product.mrp }}
              </p>
          {% endif %} -->


          {# ================= DEAL PRICE (Pricing Monitor) ================= #}
          {% if product.has_deal_price %}
              <p style="color:red;font-weight:600;">
                  SPL PROMOTION PRICE
              </p>

              <p style="text-decoration:line-through;color:#888;">
                  ₹{{ product.mrp }}
              </p>

              <p style="color:green;font-weight:700;">
                  ₹{{ product.sale_price }}
              </p>

          {# ================= PROMOTION PRICE ================= #}
          {% elif product.active_promotion %}
              <p style="color:red;font-weight:600;">
                {{product.get_promotion_label|upper}}<br>
                  {% if product.active_promotion.discount_type == "PERCENTAGE" or product.active_promotion.discount_type == "percentage" %}
                      DISCOUNT: {{ product.active_promotion.discount_value|floatformat:0 }}% OFF
                  {% else %}
                      DISCOUNT: Flat ₹{{ product.active_promotion.discount_value|floatformat:0 }} OFF
                  {% endif %}
              </p>

              <p style="text-decoration:line-through;color:#888;">
                  ₹{{ product.mrp }}
              </p>

              <p style="color:green;font-weight:700;">
                  ₹{{ product.final_price }}
              </p>

          {# ================= NO PROMO ================= #}
          {% else %}
              <p style="color:#999;">NO PROMO</p>              
                {% if product.sale_price %}
                  <p>MRP:&nbsp;<span style="text-decoration:line-through;color:#888;"><strong> ₹{{ product.mrp }} </strong></span></p>    
                  <p>Sale Price: &nbsp; <span style="color:green;font-weight:700;">₹{{ product.sale_price }}</span></p>
                {% else %}
                  ₹{{ product.mrp }}
                {% endif %}
              </p>
          {% endif %}





          
            

          </div>

          <!-- ACTION -->
          <form method="post" action="{% url 'cart:add' product.id %}">
            {% csrf_token %}

            <div class="flex items-center gap-4 mb-6">
                <input
                type="number"
                name="quantity"
                value="1"
                min="1"
                class="w-20 border rounded px-3 py-2"
                >

                <button
                type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition"
                >
                Add to Cart
                </button>
            </div>
            </form>


          <!-- DESCRIPTION -->
          <div class="border-t pt-4 text-sm text-gray-600 leading-relaxed">
            {{ product.description|linebreaks }}
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}
